# Superstore Database Project

This project is a SQL-based implementation of a superstore database, including tables for product details, customer details, order details, billing details, and shipping details. It covers various SQL operations, such as inserting, deleting, updating, and selecting data. Additionally, it includes examples of triggers, functions, views, and procedures for more complex database operations.

## Table of Contents
- [Database Schema](#database-schema)
- [SQL Operations](#sql-operations)
- [Triggers, Functions, Views, Procedures](#triggers-functions-views-procedures)
- [Optimizations](#optimizations)

## Database Schema

The database schema includes the following tables:
- `Product_Details`
- `Customer_Details`
- `Order_Details`
- `Billing_Details`
- `Shipping_Details`
- `Order_Product`
- `Order_Customer`

## SQL Operations

### Inserting Operation

1. Insert a new product into the Product_Details table:

    ```sql
    INSERT INTO Product_Details (Product_ID, Product_Name, Category, Sub_Category, unit_price, Sales, Row_ID)
    VALUES ('TEC-CO-5800', 'Lenovo IdeaPad 5', 'Technology', 'Computers', 1000, 500000, 324);
    ```

### Deleting Operation

2. Delete a product from the Product_Details table:

    ```sql
    DELETE FROM Product_Details
    WHERE Product_ID = 'TEC-CO-5800';
    ```

### Updating Operation

3. Update the unit price of a product in the Product_Details table:

    ```sql
    UPDATE Product_Details
    SET unit_price = 625.00
    WHERE Product_ID = 'TEC-PH-5356';
    ```

### Select Operation

4. Select all the orders made by a specific customer:

    ```sql
    SELECT *
    FROM Order_Details
    WHERE Customer_ID = 'HI-185111';
    ```

## Triggers, Functions, Views, Procedures

### View

5. Create a view that shows the total sales for each product by year:

    ```sql
    CREATE VIEW product_sales_by_year AS
    SELECT pd.product_id, pd.product_name, DATE_TRUNC('year', od.order_date) AS year, SUM(bd.sales) AS total_sales
    FROM product_details pd
    INNER JOIN order_details od ON pd.product_id = od.product_id
    INNER JOIN billing_details bd ON od.order_id = bd.order_id
    GROUP BY pd.product_id, pd.product_name, DATE_TRUNC('year', od.order_date);
    ```

### Trigger

6. Create a trigger that automatically inserts a new record into the Shipping_Details table whenever a new order is inserted into the Order_Details table:

    ```sql
    -- CREATE OR REPLACE FUNCTION insert_shipping_details()
    RETURNS TRIGGER AS $$
    BEGIN
      -- Try to update the existing record with the new values
      UPDATE Shipping_Details
      SET Order_Date = NEW.Order_Date,
          Order_Priority = NEW.Order_Priority,
          Ship_Mode = NEW.Ship_Mode,
          Country = (SELECT Country FROM Customer_Details WHERE Customer_ID = NEW.Customer_ID),
          State = (SELECT State FROM Customer_Details WHERE Customer_ID = NEW.Customer_ID),
          Region = (SELECT Region FROM Customer_Details WHERE Customer_ID = NEW.Customer_ID),
          City = (SELECT City FROM Customer_Details WHERE Customer_ID = NEW.Customer_ID)
      WHERE Order_ID = NEW.Order_ID;
      
      
      -- If no record was updated, insert a new one
      IF NOT FOUND THEN
        INSERT INTO Shipping_Details (Order_ID, Order_Date, Order_Priority, Ship_Mode, Country, State, Region, City)
        SELECT NEW.Order_ID, NEW.Order_Date, NEW.Order_Priority, NEW.Ship_Mode, c.Country, c.State, c.Region, c.City
        FROM Customer_Details c
        WHERE c.Customer_ID = NEW.Customer_ID;
      END IF;
      
      RETURN NEW;
    END;
    $$ LANGUAGE plpgsql;
    
    CREATE TRIGGER trg_insert_shipping_details
    AFTER INSERT ON Order_Details
    FOR EACH ROW
    EXECUTE FUNCTION insert_shipping_details();
        ```

### Procedure

7. Create a procedure to calculate the total revenue generated by a customer in a particular year:

    ```sql
    -- Procedure creation statements
    ```

## Optimizations

8. Optimize the query to retrieve the top 10 customers with the highest total sales:

    ```sql
    -- Optimized query statements
    ```

9. Optimize the query to update product sales:

    ```sql
    -- Optimized query statements
    ```

## Contributors

- [Your Name]

Feel free to contribute to this project by opening issues or submitting pull requests.
